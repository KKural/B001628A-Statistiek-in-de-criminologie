---
title: "Test Image Saving"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)

# Function to save plots to Dodona directories
save_dodona_image <- function(plot_obj, question_number, filename = NULL) {
  if (is.null(filename)) {
    filename <- paste0("question_3.", question_number, ".png")
  }
  
  # Define the path to the appropriate Dodona directory
  question_dirs <- c(
    "3" = "3.3 Correlatie - Belangrijkste maatregelen",
    "8" = "3.8 Correlatie - Interpreteer correlatie", 
    "9" = "3.9 Correlatie - Wat correlatie vertelt",
    "12" = "3.12 Correlatie - Covariantie verschillen",
    "14" = "3.14 Correlatie - Pearson vs Spearman",
    "15" = "3.15 Correlatie - Richting en kracht",
    "18" = "3.18 Correlatie - Wanneer welke correlatie",
    "19" = "3.19 Correlatie - Impact uitschieters",
    "21" = "3.21 Correlatie - Correlatie interpretatie",
    "23" = "3.23 Correlatie - Correlatie aannames"
  )
  
  if (as.character(question_number) %in% names(question_dirs)) {
    dir_name <- question_dirs[as.character(question_number)]
    image_path <- file.path(dir_name, "images", filename)
    
    # Create directory if it doesn't exist
    dir.create(dirname(image_path), recursive = TRUE, showWarnings = FALSE)
    
    # Save the plot
    ggsave(image_path, plot_obj, width = 10, height = 6, dpi = 300)
    cat("Saved image:", image_path, "\n")
  }
}
```

```{r test-save, echo=FALSE}
# Test image saving for Q8
set.seed(123)
n <- 80
x <- rnorm(n, 50, 10)
y <- 0.75 * scale(x)[,1] * 10 + rnorm(n, 60, 6)

pos_cor_data <- data.frame(Variable_X = x, Variable_Y = y)
r_value <- round(cor(x, y), 2)

p_q8 <- ggplot(pos_cor_data, aes(x = Variable_X, y = Variable_Y)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", formula = y ~ x, se = TRUE, color = "darkred") +
  labs(
    title = paste0("Sociale Cohesie vs Misdaadpreventie (r = ", r_value, ")"),
    x = "Sociale Cohesie Score",
    y = "Preventie Effectiviteit",
    caption = "75 Belgische gemeenten"
  ) +
  theme_minimal()

print(p_q8)
save_dodona_image(p_q8, 8)
```